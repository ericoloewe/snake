var Model;!function(t){!function(t){t[t.right=0]="right",t[t.left=1]="left",t[t.up=2]="up",t[t.down=3]="down"}(t.Direction||(t.Direction={}));t.Direction}(Model||(Model={}));var Model;!function(t){!function(t){t[t.Snake=0]="Snake",t[t.Food=1]="Food",t[t.Null=2]="Null"}(t.WhatIsThisTypes||(t.WhatIsThisTypes={}));t.WhatIsThisTypes}(Model||(Model={}));var Model;!function(t){var e=function(){function e(e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),this.x=e,this.y=i,this.whatIsIt=n||t.WhatIsThisTypes.Null}return e}();t.Pointer=e}(Model||(Model={}));var Model;!function(t){var e=function(){function t(){this.actual=0}return t.prototype.loadHighScore=function(){this.actual=window.localStorage.getItem("highScore"),null==this.actual&&window.localStorage.setItem("highScore","0")},t.prototype.setHighScore=function(t){window.localStorage.setItem("highScore",t.toString()),this.actual=t},t.prototype.isBestScore=function(t){return this.actual<t?(this.setHighScore(t),!0):!1},t.prototype.toString=function(){return"SCORE: "+this.actual},t.prototype.highScoreToString=function(){return"HIGH SCORE: "+this.actual},t}();t.Score=e}(Model||(Model={}));var Model;!function(t){var e=function(){function e(t,e){this.create_food(t,e)}return e.prototype.create_food=function(e,i){this.pointer={x:e,y:i,whatIsIt:t.WhatIsThisTypes.Food}},e}();t.Food=e}(Model||(Model={}));var Model;!function(t){var e=function(){function e(){this.pointers=new Array,this.face=new t.Pointer(e.INITIAL_LENGTH,0),this.head=new t.Pointer(e.INITIAL_LENGTH-1,0),this.tail=new t.Pointer,this.before_tail=new t.Pointer(-1,0),this.score=new t.Score,this.create_snake(),this.direction=t.Direction.right}return Object.defineProperty(e,"INITIAL_LENGTH",{get:function(){return 5},enumerable:!0,configurable:!0}),e.prototype.create_snake=function(){this.pointers=new Array(new t.Pointer(0,0,t.WhatIsThisTypes.Snake));for(var i=0;i<=e.INITIAL_LENGTH-1;i++)this.pointers.push(new t.Pointer(i,0,t.WhatIsThisTypes.Snake));this.pointers.shift(),this.pointers.sort(function(t,e){return t.x<e.x?1:t.x>e.x?-1:0})},e}();t.Snake=e}(Model||(Model={}));var Model;!function(t){var e=function(){function e(){this.food=new t.Food,this.snake=new t.Snake,this.highScore=new t.Score,this.highScore.loadHighScore(),this.paintHighScore(),this.speed=50,this.game_loop=void 0,this.own=null,this.height=40,this.width=50,this.initMatriz()}return Object.defineProperty(e,"MIN_SPEED",{get:function(){return 100},enumerable:!0,configurable:!0}),e.prototype.init=function(){var t=this;this.food.create_food(Math.round(Math.random()*this.width),Math.round(Math.random()*this.height)),this.putSnakeOnMatriz(),this.paintArena(),this.paintSnake(),this.paintFood(),$(".init").click(function(){$(".menu").addClass("hidden"),t.start()})},e.prototype.putSnakeOnMatriz=function(){var t=this;this.snake.pointers.forEach(function(e){t.matriz[e.y][e.x].whatIsIt=e.whatIsIt})},e.prototype.initMatriz=function(){this.matriz=[];for(var e=0;e<this.height;e++){this.matriz[e]=[];for(var i=0;i<this.width;i++)this.matriz[e][i]=new t.Pointer(i,e)}},e.prototype.start=function(){var t=this;this.game_loop=setInterval(function(){t.play()},this.speed)},e.prototype.processToRestart=function(){$(".menu.menu-game-over").removeClass("hidden"),$(".restart").click(function(){$(".menu.menu-game-over").addClass("hidden"),arena.restart()})},e.prototype.restart=function(){var i=this;this.snake=new t.Snake,this.cleanArena(),this.paintSnake(),this.paintFood(),this.speed=e.MIN_SPEED,void 0!=typeof this.game_loop&&clearInterval(this.game_loop),this.game_loop=setInterval(function(){i.play()},this.speed)},e.prototype.play=function(){return this.snakeIsOut()||this.checkCollision()?void this.processToRestart():(this.changePointers(),this.paintSnake(),void this.checkDirection())},e.prototype.paintCell=function(t,e,i){void 0===i&&(i="activeSnake"),this.own.find(".y"+e+" .x"+t).addClass(i)},e.prototype.eraseCell=function(t,e,i){void 0===i&&(i="activeSnake"),this.own.find(".y"+e+" .x"+t).removeClass(i)},e.prototype.cleanArena=function(){this.own.find("tr td").removeClass("activeSnake"),this.own.find("tr td").removeClass("activeFood")},e.prototype.cleanSnake=function(t){void 0===t&&(t="activeSnake"),this.own.find("tr td").hasClass(t)&&this.own.find("tr td").removeClass(t)},e.prototype.cleanSnakeHead=function(t){void 0===t&&(t="activeSnakeHead"),this.own.find("tr td").hasClass(t)&&this.own.find("tr td").removeClass(t)},e.prototype.cleanFood=function(t){void 0===t&&(t="activeFood"),this.own.find("tr td").hasClass(t)&&this.own.find("tr td").removeClass(t)},e.prototype.paintArena=function(){for(var t="",e=0;e<this.height;e++){t+="<tr height='10' class='y"+e+"'>";for(var i=0;i<this.width;i++)t+="<td width='10' class='x"+i+"'></td>";t+="</tr>"}this.own.html(t)},e.prototype.paintFood=function(){this.cleanFood(),this.paintCell(this.food.pointer.x,this.food.pointer.y,"activeFood"),$(".score").text(this.snake.score.toString())},e.prototype.paintSnake=function(){var t=this;this.own.find("tr td.activeSnake").length===this.snake.pointers.length?this.mosey():(this.cleanSnake(),this.snake.pointers.forEach(function(e){t.paintCell(e.x,e.y)})),this.paintSnakeHead()},e.prototype.paintHighScore=function(){$(".bestScore").text(this.highScore.highScoreToString())},e.prototype.paintSnakeHead=function(){this.cleanSnakeHead(),this.paintCell(this.snake.head.x,this.snake.head.y,"activeSnakeHead")},e.prototype.clearLastCell=function(){this.eraseCell(this.snake.before_tail.x,this.snake.before_tail.y)},e.prototype.checkDirection=function(){this.snake.direction==t.Direction.left?this.snake.face.x--:this.snake.direction==t.Direction.up?this.snake.face.y--:this.snake.direction==t.Direction.down?this.snake.face.y++:this.snake.face.x++},e.prototype.snakeIsOut=function(){return-1==this.snake.head.x||this.snake.head.x==this.width||-1==this.snake.head.y||this.snake.head.y==this.height},e.prototype.snakeEat=function(){return this.snake.head.x==this.food.pointer.x&&this.snake.head.y==this.food.pointer.y},e.prototype.verifyAndChangeHighScore=function(){this.highScore.isBestScore(this.snake.score.actual)&&this.paintHighScore()},e.prototype.checkCollision_old=function(){var t=this,e=!1;return this.snake.pointers.forEach(function(i){i.x==t.snake.face.x&&i.y==t.snake.face.y&&(e=!0)}),e},e.prototype.checkCollision=function(){return this.matriz[this.snake.face.y][this.snake.face.x].whatIsIt==t.WhatIsThisTypes.Snake},e.prototype.mosey=function(){this.clearLastCell(),this.paintCell(this.snake.face.x,this.snake.face.y)},e.prototype.changePointers=function(){var e,i;this.snakeEat()?(this.snake.score.actual++,this.matriz[this.food.pointer.y][this.food.pointer.x].whatIsIt=null,e=Math.round(Math.random()*this.width),i=Math.round(Math.random()*this.height),this.food.create_food(e,i),this.matriz[i][e].whatIsIt=t.WhatIsThisTypes.Food,this.paintFood(),this.verifyAndChangeHighScore(),this.speedUpSnake()):(this.snake.before_tail=this.snake.pointers.pop(),this.matriz[this.snake.before_tail.y][this.snake.before_tail.x].whatIsIt=t.WhatIsThisTypes.Null),this.snake.head=new t.Pointer(this.snake.face.x,this.snake.face.y,t.WhatIsThisTypes.Snake),this.snake.tail=this.snake.pointers[this.snake.pointers.length-1],this.snake.pointers.unshift(this.snake.head),this.matriz[this.snake.head.y][this.snake.head.x].whatIsIt=t.WhatIsThisTypes.Snake},e.prototype.speedUpSnake=function(){this.speed=100*this.speed/e.MIN_SPEED-5,console.log(this.speed)},e}();t.Arena=e}(Model||(Model={}));var arena=new Model.Arena;$(document).ready(function(){arena.cellWidth=10,arena.own=$(".arena"),arena.width=50,arena.height=40,arena.init(),$(document).keydown(function(t){var e=t.which;37==e&&arena.snake.direction!=Model.Direction.right?arena.snake.direction=Model.Direction.left:38==e&&arena.snake.direction!=Model.Direction.down?arena.snake.direction=Model.Direction.up:39==e&&arena.snake.direction!=Model.Direction.left?arena.snake.direction=Model.Direction.right:40==e&&arena.snake.direction!=Model.Direction.up&&(arena.snake.direction=Model.Direction.down)})});